---
layout: post
title: ğŸ¥¯ê²Œì‹œíŒ ë§Œë“¤ê¸°4 - spring mvc + mybatis (ë¡œê·¸ì¸ êµ¬í˜„)
date: 2020-11-04 14:20:00
author: 'SeWonKim'
categories: [WEB, Java]
tags: [Java, web, spring, mybatis]
comments: true
---

## View - login.jsp

- ìœ íš¨ì„± ê²€ì‚¬ í›„, ë¹„ë™ê¸°ë¡œ login

```javascript

<script>
$(document).ready(function(){
	$("#btnLogin").click(function(){
		if( validate() ){
			login();
		}
	});
});

function validate(){

	var userEmailValue = $("#userEmail").val();
	var userEmailLength = userEmailValue.length;
	if( userEmailLength === 0 ) return false;

	var userPasswordValue = $("#userPassword").val();
	var userPasswordLength = userPasswordValue.length;
	if( userPasswordLength === 0 ) return false;

	return true;
}

function login(){

	/* json í˜•íƒœë¡œ parameterì— ì „ë‹¬ */
	let jsonData = JSON.stringify(
			{ userEmail: $("#userEmail").val(), userPassword: $("#userPassword").val() }
		);

	$.ajax(
	{
        type : 'post',
        url : '<%= contextPath %>/login',
        dataType : 'json',	/* ì‘ë‹µì„ json í˜•íƒœë¡œ ë°›ìŒ */
        data : jsonData,
        contentType:"application/json; charset=UTF-8", 	/* json í˜•íƒœë¡œ ìš”ì²­ */
        success : function(data, status, xhr) {
			console.log(data);

			/* ê²Œì‹œíŒ ëª©ë¡ìœ¼ë¡œ ì´ë™ */
        	window.location.href="<%=contextPath%>/board";
        },
        error: function(jqXHR, textStatus, errorThrown)
        {
        	alertify.notify(
       			'Opps!! ì„œë²„ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
       			'error', //'error','warning','message'
       			3, //-1
       			function(){
       				console.log(jqXHR.responseText);
       			}
       		);
        }
    });
}

</script>
```

## DTO

<details markdown="1">
<summary>UserDto</summary>

- profile image url ì•„ë¬´ê²ƒë„ ì„¤ì •í•œ ê²Œ ì—†ìœ¼ë©´ default image ë„£ì–´ì¤€ë‹¤. (setUserProfileImageUrl)

```java
package com.mycom.myboard.dto;

import java.util.Date;

public class UserDto {
	private int userSeq;
	private String userName;
	private String userPassword;
	private String userEmail;
	private String userProfileImageUrl;
	private Date userRegisterDate;

	public int getUserSeq() {
		return userSeq;
	}
	public void setUserSeq(int userSeq) {
		this.userSeq = userSeq;
	}
	public String getUserName() {
		return userName;
	}
	public void setUserName(String userName) {
		this.userName = userName;
	}
	public String getUserPassword() {
		return userPassword;
	}
	public void setUserPassword(String userPassword) {
		this.userPassword = userPassword;
	}
	public String getUserEmail() {
		return userEmail;
	}
	public void setUserEmail(String userEmail) {
		this.userEmail = userEmail;
	}
	public String getUserProfileImageUrl() {
		return userProfileImageUrl;
	}
	public void setUserProfileImageUrl(String userProfileImageUrl) {
		if( userProfileImageUrl == null || "null".equals(userProfileImageUrl) || "".equals(userProfileImageUrl)) {
			this.userProfileImageUrl = "/img/noProfile.png";
		}else {
			this.userProfileImageUrl = userProfileImageUrl;
		}
	}

	public Date getUserRegisterDate() {
		return userRegisterDate;
	}
	public void setUserRegisterDate(Date userRegisterDate) {
		this.userRegisterDate = userRegisterDate;
	}
}

```

</details>

## Queryë¬¸ - Mapper xml íŒŒì¼

<details markdown="1">
<summary>user_query.xml</summary>

- selectë¬¸ ì‘ì„±
- input ê°’ì€ parameterType, returnê°’ì€ resultTypeìœ¼ë¡œ í‘œì‹œ
- íŒŒë¼ë¯¸í„°ëŠ” `#{}` ìœ¼ë¡œ í‘œì‹œ

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycom.myboard.dao.UserDao">

	<select id="login" parameterType="string" resultType="com.mycom.myboard.dto.UserDto">
		SELECT USER_SEQ as userSeq, USER_NAME as userName, USER_PASSWORD as userPassword, USER_EMAIL as userEmail,
			   USER_PROFILE_IMAGE_URL, USER_REGISTER_DATE as userRegisterDate
		  FROM USER
		 WHERE USER_EMAIL = #{userEmail}
	</select>
</mapper>
```

</details>

## DAO

<details markdown="1">
<summary>UserDao</summary>

- DAO interface (impl êµ¬í˜„ í•„ìš” ì—†ìŒ)
- @Mapper annotaion ëª…ì‹œí•˜ì—¬ mybatisê°€ ë§µí•‘í•  ìˆ˜ ìˆë„ë¡ í•¨

```java
package com.mycom.myboard.dao;

import org.apache.ibatis.annotations.Mapper;

import com.mycom.myboard.dto.UserDto;

@Mapper
public interface UserDao {
	public UserDto login(String userEmail);
}
```

</details>

## Service

<details markdown="1">
<summary>UserServiceImpl</summary>

- @Service annotation
- @Autowiredë¡œ dao ë°›ì•„ì˜¤ê¸°

```java
package com.mycom.myboard.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.mycom.myboard.dao.UserDao;
import com.mycom.myboard.dto.UserDto;

@Service
public class UserServiceImpl implements UserService {

	@Autowired
	UserDao userDao;

	@Override
	public UserDto login(UserDto dto) {
		UserDto userDto = userDao.login(dto.getUserEmail());

		if( userDto != null && userDto.getUserPassword().equals(dto.getUserPassword())) {
			return userDto;
		}
		return null;
	}

}
```

</details>

## Controller

<details markdown="1">
<summary>UserController</summary>

- @RestController : json í˜•íƒœë¡œ returnê°’ì„ ì¤„ ë•Œ @ResponseBody annotationì„ ë¶™ì´ì§€ ì•Šì•„ë„ ëœë‹¤.
- @RequestBody : json í˜•íƒœë¡œ input parameteer ê°’ì„ ë°›ì•„ì˜¨ë‹¤.
- @Autowiredë¡œ service ë°›ì•„ì˜¤ê¸°
- ResponseEntity typeì€ ë°˜í™˜ê°’ê³¼ http status codeë¥¼ ê°™ì´ ë‹´ì•„ì„œ return í•  ìˆ˜ ìˆë‹¤.
- ë¡œê·¸ì¸ ì„±ê³µí•˜ë©´ sessionì— userDto ê°’ ì €ì¥

```java
package com.mycom.myboard.controller;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RestController;

import com.mycom.myboard.dto.UserDto;
import com.mycom.myboard.service.UserService;

@RestController
public class UserController {

	@Autowired
	UserService userService;

	@PostMapping("/login")
	public ResponseEntity<UserDto> login(@RequestBody UserDto dto, HttpSession session){

		UserDto userDto = userService.login(dto);
		if( userDto != null ) {
			session.setAttribute("userDto", userDto);
			return new ResponseEntity<UserDto>(userDto, HttpStatus.OK);
		}
		return  new ResponseEntity<UserDto>(userDto, HttpStatus.NOT_FOUND);
	}


}

```

</details>
