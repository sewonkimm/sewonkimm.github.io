---
layout: post
title: ğŸ©Spring framework - Ioc/DI
date: 2020-10-25 22:30:00
author: 'SeWonKim'
categories: [Java]
tags: [jekyll, TIL, Java, web, spring]
fullview: false
comments: true
description: Spring framework ê°œë…
---

### Spring ì´ì „ì— ì‚¬ìš©í•˜ë˜ EJB

- Session Bean, Entity Bean ë“±ì˜ ìš”ì†Œë“¤ì„ ì„¤ì •í•´ì•¼í•œë‹¤. 
- ê¸°ì¡´ì— ì‘ì„±ëœ `POJO`ë¥¼ ë³€ê²½í•´ì•¼í•œë‹¤.
- ë°°ìš°ê¸°ë„ ì–´ë ¤ì›Œ...ğŸ˜¤
- í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ë°˜ë“œì‹œ EJB ì„œë²„ê°€ í•„ìš”í•˜ì—¬ í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë µê³ , ê°œë°œì˜ íš¨ìœ¨ì„±ì´ ë–¨ì–´ì ¸ *Spring ë“±ì¥*!

### Spring Framework

- DI, AOP ì™€ ê°™ì€ ìƒˆë¡œìš´ í”„ë¡œê·¸ë˜ë° ë°©ë²•ë¡ ìœ¼ë¡œ ê°€ëŠ¥
- POJO + Framework
- ê°œë°œìê°€ low levelì— ì‹ ê²½ì“°ì§€ ì•Šê³ , business logic ê°œë°œì— ì „ë…í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.
- ë‚˜ì¤‘ì—ëŠ” Springì´ ë‹¤ë¥¸ í”„ë ˆì„ì›Œí¬ì— ë¹„í•´ ë¬´ê±°ì›Œì ¸ì„œ *Spring bootê°€ ë“±ì¥*! => xml ì„¤ì •ì„ í•˜ì§€ ì•Šì•„ë„ ê°œë°œì„ ì‹œì‘í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.


`POJO(Plain Old Java Object)` : íŠ¹ì • í”„ë ˆì„ì›Œí¬ë‚˜ ê¸°ìˆ ì— ì˜ì¡´ì ì´ì§€ ì•Šì€ ìë°” ê°ì²´

---

## IoC(Inversion of Control) íŒ¨í„´

ì œì–´ì˜ ì—­í–‰       
: ë¯¸ë¦¬ ê°ì²´ë¥¼ ë§Œë“¤ì–´ë†“ê³ , í•„ìš”í•œ ë•Œì— ê°€ì ¸ì™€ì„œ ì“´ë‹¤.      
ê°ì²´ ê°„ì˜ ê°•í•œ ê²°í•©ì„ Factoryë¥¼ í†µí•´ ëŠìŠ¨í•˜ê²Œ ë§Œë“ ë‹¤. (ì‹±ê¸€í†¤ íŒ¨í„´ ì ìš©)


IoCì˜ êµ¬í˜„ ë°©ë²• ì¤‘ í•˜ë‚˜ê°€ DI(Dependecy Injection)       
- containerì— beanì„ ë“±ë¡í•˜ê³  ì„¤ì •í•˜ëŠ” ë°©ë²•ì€ xmlì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ê³¼ annotationì„ í™œìš©í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.
- applicationContext.xml ì— beaníƒœê·¸ë¥¼ ì‚¬ìš©í•´ì„œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê´€ë¦¬í•œë‹¤

---

## Spring í”„ë¡œì íŠ¸ ìƒì„±

### pom.xml 

- Spring library ì„¤ì •ì€ pom.xml ì—ì„œ!
- ë²„ì „ 5.2.6 ì‚¬ìš©

MVNRepositoryì—ì„œ ì˜ì¡´ ê´€ê³„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.     
ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í•˜ë‚˜í•˜ë‚˜ buildpathì— import ì‹œí‚¬ í•„ìš”ì—†ì´ ì•Œì•„ì„œ ë°›ì•„ì¤€ë‹¤. ì˜ˆì‹œğŸ‘‡
```
<!-- https://mvnrepository.com/artifact/org.springframework/spring-context -->
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-context</artifactId>
    <version>5.2.6.RELEASE</version>
</dependency>
```

### applicationContext.xml

- ë‚´ê°€ ê´€ë¦¬í•´ì•¼ í•˜ëŠ” ê°ì²´ ì •ë³´ë¥¼ ì ì–´ ë†“ëŠ”ë‹¤.
- **ApplicationContext**(ì£¼ì…ê¸° ì—­í• )ì— ì—¬ê¸° ì €ì¥ë˜ì–´ ìˆëŠ” ê°’ë“¤ì„ ë‹´ê³ 
- getBean() ë©”ì†Œë“œë¥¼ í†µí•´ì„œ ì €ì¥ ëœ ê°ì²´ë¥¼ ê°€ì ¸ì™€ ì‚¬ìš©í•œë‹¤. 
- Annnotationì„ í™œìš©í•˜ëŠ” ê²½ìš° **@Autowired** ë¼ëŠ” bean scannerë¥¼ í†µí•´ í¸í•˜ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. (ì´ë•Œ ë°˜ë“œì‹œ component-scanì„ ì„¤ì •í•´ì•¼í•œë‹¤!)
- singleton, prototype(singletonì´ ì ìš©ë˜ì§€ ì•ŠëŠ”) ë“±ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

### XML ë²„ì „: applicationContext.xml
```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

// dbì™€ ì—°ê²°
	<bean id="ds" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
		<property name="driverClass" value="com.mysql.cj.jdbc.Driver"/>
		<property name="url" value="jdbc:mysql://127.0.0.1:3306/ssafyweb?serverTimezone=UTC&amp;useUniCode=yes&amp;characterEncoding=UTF-8"/>
		<property name="username" value="ssafy"/>
		<property name="password" value="ssafy"/>
	</bean>

// instance ìƒì„±

    // DAOëŠ” ds ê°€ í•„ìš”í•˜ê³ 
	<bean id="gbDao" class="com.ssafy.model.dao.GuestBookDaoImpl">
		<property name="dataSource" ref="ds"/>  // 1. í”„ë¡œí¼í‹°ë¡œ ì£¼ì…í•˜ëŠ” ë°©ë²•
        <constructor-arg reg="ds" />            // 2. ìƒì„±ìë¡œ ì£¼ì…í•˜ëŠ” ë°©ë²• (íƒ 1)            
	</bean>
	<bean id="lDao" class="com.ssafy.model.dao.LoginDaoImpl">
		<property name="dataSource" ref="ds"/>
	</bean>
	
    // ServiceëŠ” DAOê°€ í•„ìš”í•˜ë‹¤ (ref í™•ì¸!)
	<bean id="gbService" class="com.ssafy.model.service.GuestBookServiceImpl">
		<property name="guestBookDao" ref="gbDao"/>
	</bean>
	<bean id="lService" class="com.ssafy.model.service.LoginServiceImpl">
		<property name="loginDao" ref="lDao"/>
	</bean>

</beans>
```

DataSourceë¥¼ ë°›ì•„ì™€ì„œ ì‚¬ìš©


### Annotation ë²„ì „ : ApplicationConfig.java
```java
package com.ssafy.configuration;

import javax.sql.DataSource;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
import org.springframework.jdbc.datasource.SimpleDriverDataSource;

@Configuration
@ComponentScan(basePackages = {"com.ssafy"})
public class ApplicationConfig {
	
	@Bean
	public DataSource dataSource() {
		SimpleDriverDataSource ds = new SimpleDriverDataSource();
		ds.setDriverClass(com.mysql.cj.jdbc.Driver.class);
		ds.setUrl("jdbc:mysql://127.0.0.1:3306/ssafyweb?serverTimezone=UTC&useUniCode=yes&characterEncoding=UTF-8");
		ds.setUsername("ssafy");
		ds.setPassword("ssafy");
		return ds;
	}

}
```

bean ë“±ë¡ í•„ìš” ì—†ì´ ë°”ë¡œ
```java
@Autowired
private DataSource dataSource;
```
ë¥¼ í†µí•´ ì£¼ì…ë°›ì•„ ì‚¬ìš©

@AutowiredëŠ” DataSource íƒ€ì…ê³¼ ì¼ì¹˜í•˜ëŠ” ê²ƒì„ configurationì—ì„œ ìë™ìœ¼ë¡œ ê°€ì ¸ì™€ì„œ ì—°ê²°í•´ì¤€ë‹¤.    
ë™ì¼í•œ íƒ€ì…ì˜ beanì´ ì—¬ëŸ¬ê°œì¼ ê²½ìš° @Qualifier("ì´ë¦„") ìœ¼ë¡œ ì‹ë³„

### Annotation : Spring bean ì„¤ì •

- @Controller
- @Service
- @Repository : DAO
- @Component : ê·¸ ì™¸ layer êµ¬ë¶„ì´ ì–´ë ¤ìš´ ê²ƒë“¤ ex) DTO
